#include<reg51.h>
#include<intrins.h>

#define uchar unsigned char  
sbit SCK=P3^6;
sbit LCK=P3^5;
sbit SDI=P3^4;


uchar code NUM_HANG[]={
0x80,0x00,0x40,0x00,0x20,0x00,0x10,0x00,0x08,0x00,0x04,0x00,0x02,0x00,0x01,0x00,
0x00,0x80,0x00,0x40,0x00,0x20,0x00,0x10,0x00,0x08,0x00,0x04,0x00,0x02,0x00,0x01,};


uchar code  NUM_ONE[]={
0xFF,0xBF,0xDF,0xBF,0xEF,0xBF,0xE8,0x01,0x7B,0xBB,0xB7,0xB7,0xBF,0xBF,0xEF,0x5F,
0xEF,0x5F,0xDF,0x5F,0x1E,0xDF,0xDE,0xDF,0xDD,0xDD,0xDD,0xDD,0xDB,0xE1,0xF7,0xFF,};
 
uchar code  CH_CHAR_PU[]={
0x00,0x40,0xfe,0x40,0x28,0x40,0x28,0x7e,0xfe,0xaa,0xab,0x2a,0xaa,0x2a,0xfe,0x4a,
0x10,0x4a,0xfe,0x92,0x25,0x12,0x44,0x22,0x28,0x22,0x10,0x42,0x28,0x94,0xc4,0x08,};

void HC595_Send(uchar dat1,uchar dat0,uchar dat3,uchar dat2);

void main()
{
	uchar i,j;
	while(1)
	{	
		for(j=255;j>0;j--)	 //????????,?256?????????
		{
			for(i=0;i<32;i=i+2)	//???16?,???16?
			{
				HC595_Send(NUM_ONE[i],NUM_ONE[i+1],NUM_HANG[i],NUM_HANG[i+1]);	
			}
		}
		HC595_Send(0xff,0xff,0x00,0x00);
		for(j=255;j>0;j--)
		{	
			for(i=0;i<32;i=i+2)
			{
				HC595_Send(~CH_CHAR_PU[i],~CH_CHAR_PU[i+1],NUM_HANG[i],NUM_HANG[i+1]);	
			}
		}	
		HC595_Send(0xff,0xff,0x00,0x00);
	}	
}
void HC595_Send(uchar dat1,uchar dat0,uchar dat3,uchar dat2)
{
	uchar i;
	SCK=0;
	LCK=0;
	for(i=0;i<8;i++)
	{
		SDI=dat0&0x01;		//??????
		dat0>>=1;
		SCK=0;
		_nop_();
		_nop_();
		SCK=1;
		_nop_();
		_nop_();	
	}
	for(i=0;i<8;i++)
	{
		SDI=dat1&0x01;		//??????
		dat1>>=1;
		SCK=0;
		_nop_();
		_nop_();
		SCK=1;
		_nop_();
		_nop_();	
	}
	for(i=0;i<8;i++)
	{
		SDI=dat2&0x01;		//??????
		dat2>>=1;
		SCK=0;
		_nop_();
		_nop_();
		SCK=1;
		_nop_();
		_nop_();	
	}
	for(i=0;i<8;i++)
	{
		SDI=dat3&0x01;		//??????
		dat3>>=1;
		SCK=0;
		_nop_();
		_nop_();
		SCK=1;
		_nop_();
		_nop_();	
	}
	LCK=0;	//???????
	_nop_();
	_nop_();
	LCK=1;
	_nop_();
	_nop_();
}
